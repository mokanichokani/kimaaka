Environment check:
Current directory: /Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server
MONGODB_URI exists: true
JWT_SECRET exists: true
MONGODB_URI starts with mongodb: true

============================================================
[2025-08-10T16:56:31.163Z] üöÄ Kimaaka Server Started Successfully!
[2025-08-10T16:56:31.163Z] üåê Server running on port 3001
[2025-08-10T16:56:31.163Z] üìä Admin panel (via server): http://localhost:3001/admin/admin.html
[2025-08-10T16:56:31.163Z] üìä Admin panel (standalone): See admin-dashboard/README.md
[2025-08-10T16:56:31.163Z] üîë API endpoint: http://localhost:3001/api/gemini-key
[2025-08-10T16:56:31.163Z] üíù Donation endpoint: http://localhost:3001/api/donate-key
[2025-08-10T16:56:31.163Z] üìã Health check: http://localhost:3001/api/health
============================================================
[2025-08-10T16:56:31.163Z] üëÄ Monitoring all requests...

[2025-08-10T16:56:31.362Z] üîó Mongoose connected to MongoDB
[2025-08-10T16:56:31.364Z] üóÑÔ∏è Connected to MongoDB successfully
üìä Resumed usage tracking for server: http://localhost:3001/api
[2025-08-10T16:59:30.706Z] GET /api/health - IP: ::1
[2025-08-10T16:59:30.706Z] Response: 200 GET /api/health
[2025-08-10T16:59:37.913Z] GET /api/health - IP: ::1
[2025-08-10T16:59:37.913Z] Response: 200 GET /api/health
[2025-08-10T16:59:39.954Z] GET /api/health - IP: ::1
[2025-08-10T16:59:39.954Z] Response: 200 GET /api/health
[2025-08-10T16:59:54.522Z] GET /api/health - IP: ::1
[2025-08-10T16:59:54.522Z] Response: 200 GET /api/health
[2025-08-10T17:10:32.091Z] GET /api/health - IP: ::1
[2025-08-10T17:10:32.091Z] Response: 200 GET /api/health
[2025-08-10T17:10:35.576Z] GET /api/health - IP: ::1
[2025-08-10T17:10:35.576Z] Response: 200 GET /api/health
[2025-08-10T17:10:46.320Z] GET /api/health - IP: ::1
[2025-08-10T17:10:46.320Z] Response: 200 GET /api/health
[2025-08-10T17:11:01.445Z] GET /api/health - IP: ::1
[2025-08-10T17:11:01.445Z] Response: 200 GET /api/health
[2025-08-10T17:11:31.446Z] GET /api/health - IP: ::1
[2025-08-10T17:11:31.446Z] Response: 200 GET /api/health
[2025-08-10T17:12:32.445Z] GET /api/health - IP: ::1
[2025-08-10T17:12:32.445Z] Response: 200 GET /api/health
[2025-08-10T17:13:33.448Z] GET /api/health - IP: ::1
[2025-08-10T17:13:33.448Z] Response: 200 GET /api/health
[2025-08-10T17:14:00.540Z] GET /api/health - IP: ::1
[2025-08-10T17:14:00.540Z] Response: 200 GET /api/health
[2025-08-10T17:14:08.832Z] GET /api/health - IP: ::1
[2025-08-10T17:14:08.832Z] Response: 200 GET /api/health
[2025-08-10T17:14:10.161Z] GET /api/health - IP: ::1
[2025-08-10T17:14:10.161Z] Response: 200 GET /api/health
[2025-08-10T17:19:49.358Z] GET /api/health - IP: ::1
[2025-08-10T17:19:49.358Z] Response: 200 GET /api/health
[2025-08-10T17:19:59.390Z] GET /api/health - IP: ::1
[2025-08-10T17:19:59.390Z] Response: 200 GET /api/health
[2025-08-10T17:20:00.533Z] GET /api/health - IP: ::1
[2025-08-10T17:20:00.533Z] Response: 200 GET /api/health
[2025-08-10T17:21:35.057Z] GET /api/health - IP: ::1
[2025-08-10T17:21:35.057Z] Response: 200 GET /api/health
[2025-08-10T17:22:01.439Z] GET /api/health - IP: ::1
[2025-08-10T17:22:01.439Z] Response: 200 GET /api/health
[2025-08-10T17:22:31.438Z] GET /api/health - IP: ::1
[2025-08-10T17:22:31.438Z] Response: 200 GET /api/health
[2025-08-10T17:22:41.958Z] GET /api/gemini-key - IP: ::1
[2025-08-10T17:22:41.958Z] üîë API Key Request - Using round-robin allocation...
[2025-08-10T17:22:41.959Z] üîÑ Starting round-robin API key allocation...
[2025-08-10T17:22:41.959Z] üéØ Found 2 keys with minimum allocation count: 0
[2025-08-10T17:22:41.959Z] üß™ Testing admin key AIzaSyBZ......
[2025-08-10T17:22:41.980Z] üß™ Testing API key AIzaSyBZ... with Gemini API...
[2025-08-10T17:22:41.980Z] ‚úÖ API key AIzaSyBZ... validation successful
[2025-08-10T17:22:41.959Z] ‚úÖ Key AIzaSyBZ... is valid, allocating...
[2025-08-10T17:22:41.959Z] üìä Updated admin key allocation count to 1
üìà Tracked allocation for http://localhost:3001/api - Total: 1
[2025-08-10T17:22:41.958Z] ‚úÖ API Key Provided: AIzaSyBZ...hQjg (668ms)
[2025-08-10T17:22:41.958Z] Response: 200 GET /api/gemini-key
[2025-08-10T17:22:56.353Z] GET /api/health - IP: ::1
[2025-08-10T17:22:56.353Z] Response: 200 GET /api/health
[2025-08-10T17:23:00.559Z] GET /api/health - IP: ::1
[2025-08-10T17:23:00.559Z] Response: 200 GET /api/health
[2025-08-10T17:23:03.070Z] GET /api/health - IP: ::1
[2025-08-10T17:23:03.070Z] Response: 200 GET /api/health
[2025-08-10T17:23:03.937Z] GET /api/health - IP: ::1
[2025-08-10T17:23:03.937Z] Response: 200 GET /api/health
[2025-08-10T17:23:04.696Z] GET /api/health - IP: ::1
[2025-08-10T17:23:04.696Z] Response: 200 GET /api/health
[2025-08-10T17:23:10.301Z] GET /api/health - IP: ::1
[2025-08-10T17:23:10.301Z] Response: 200 GET /api/health
[2025-08-10T17:23:11.258Z] GET /api/health - IP: ::1
[2025-08-10T17:23:11.258Z] Response: 200 GET /api/health
[2025-08-10T17:23:20.455Z] GET /api/health - IP: ::1
[2025-08-10T17:23:20.455Z] Response: 200 GET /api/health
[2025-08-10T17:23:21.115Z] GET /api/health - IP: ::1
[2025-08-10T17:23:21.115Z] Response: 200 GET /api/health
[2025-08-10T17:23:30.556Z] GET /api/health - IP: ::1
[2025-08-10T17:23:30.556Z] Response: 200 GET /api/health
[2025-08-10T17:24:01.472Z] GET /api/health - IP: ::1
[2025-08-10T17:24:01.472Z] Response: 200 GET /api/health
[2025-08-10T17:24:31.527Z] GET /api/health - IP: ::1
[2025-08-10T17:24:31.527Z] Response: 200 GET /api/health
[2025-08-10T17:25:01.469Z] GET /api/health - IP: ::1
[2025-08-10T17:25:01.469Z] Response: 200 GET /api/health
[2025-08-10T17:25:31.483Z] GET /api/health - IP: ::1
[2025-08-10T17:25:31.483Z] Response: 200 GET /api/health
[2025-08-10T17:26:32.722Z] GET /api/health - IP: ::1
[2025-08-10T17:26:32.722Z] Response: 200 GET /api/health
[2025-08-10T17:27:01.475Z] GET /api/health - IP: ::1
[2025-08-10T17:27:01.475Z] Response: 200 GET /api/health
[2025-08-10T17:27:31.471Z] GET /api/health - IP: ::1
[2025-08-10T17:27:31.471Z] Response: 200 GET /api/health
[2025-08-10T17:28:01.476Z] GET /api/health - IP: ::1
[2025-08-10T17:28:01.476Z] Response: 200 GET /api/health
[2025-08-10T17:28:48.476Z] GET /api/health - IP: ::1
[2025-08-10T17:28:48.476Z] Response: 200 GET /api/health
[2025-08-10T17:28:57.170Z] GET /api/health - IP: ::1
[2025-08-10T17:29:02.957Z] GET /api/health - IP: ::1
[2025-08-10T17:29:11.668Z] GET /api/health - IP: ::1
[2025-08-10T17:29:11.668Z] Response: 200 GET /api/health
[2025-08-10T17:29:14.503Z] POST /api/admin/auth/login - IP: ::1
[2025-08-10T17:29:14.503Z] Request Body: { username: 'mokani', password: '[HIDDEN]' }
[2025-08-10T17:29:14.504Z] üîê Admin login attempt for username: mokani
[2025-08-10T17:29:14.504Z] ‚úÖ Admin login successful: mokani
[2025-08-10T17:29:14.503Z] Response: 200 POST /api/admin/auth/login
[2025-08-10T17:29:14.766Z] GET /api/admin/stats - IP: ::1
[2025-08-10T17:29:14.766Z] Response: 200 GET /api/admin/stats
[2025-08-10T17:29:14.860Z] GET /api/health - IP: ::1
[2025-08-10T17:29:14.860Z] Response: 200 GET /api/health
[2025-08-10T17:29:02.957Z] Response: 200 GET /api/health
[2025-08-10T17:28:57.170Z] Response: 200 GET /api/health
[2025-08-10T17:29:16.010Z] GET /api/health - IP: ::1
[2025-08-10T17:29:16.010Z] Response: 200 GET /api/health
[2025-08-10T17:29:19.928Z] GET /api/health - IP: ::1
[2025-08-10T17:29:19.928Z] Response: 200 GET /api/health
[2025-08-10T17:29:25.187Z] GET /api/health - IP: ::1
[2025-08-10T17:29:25.187Z] Response: 200 GET /api/health
[2025-08-10T17:29:29.490Z] GET /api/health - IP: ::1
[2025-08-10T17:29:29.490Z] Response: 200 GET /api/health
[2025-08-10T17:29:35.900Z] GET /api/health - IP: ::1
[2025-08-10T17:29:35.900Z] Response: 200 GET /api/health
[2025-08-10T17:29:37.143Z] GET /api/health - IP: ::1
[2025-08-10T17:29:37.143Z] Response: 200 GET /api/health
[2025-08-10T17:29:38.900Z] GET /api/health - IP: ::1
[2025-08-10T17:29:38.900Z] Response: 200 GET /api/health
[2025-08-10T17:35:35.458Z] GET /api/health - IP: ::1
[2025-08-10T17:35:39.454Z] GET /api/health - IP: ::1
[2025-08-10T17:35:43.457Z] GET /api/health - IP: ::1
[2025-08-10T17:35:43.818Z] ‚ö†Ô∏è Mongoose disconnected from MongoDB
Health check error: MongoServerSelectionError: Socket 'secureConnect' timed out after 30122ms (connectTimeoutMS: 30000)
    at Topology.selectServer (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/sdam/topology.js:326:38)
    at runNextTicks (node:internal/process/task_queues:65:5)
    at listOnTimeout (node:internal/timers:569:9)
    at process.processTimers (node:internal/timers:543:7)
    at async tryOperation (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/operations/execute_operation.js:145:18)
    at async executeOperation (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/operations/execute_operation.js:75:16)
    at async AggregationCursor._initialize (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/cursor/aggregation_cursor.js:56:26)
    at async AggregationCursor.cursorInit (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/cursor/abstract_cursor.js:632:27)
    at async AggregationCursor.fetchBatch (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/cursor/abstract_cursor.js:666:13)
    at async AggregationCursor.next (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/cursor/abstract_cursor.js:342:17) {
  errorLabelSet: Set(0) {},
  reason: TopologyDescription {
    type: 'ReplicaSetNoPrimary',
    servers: Map(3) {
      'cluster0-shard-00-00.ldeju.mongodb.net:27017' => [ServerDescription],
      'cluster0-shard-00-02.ldeju.mongodb.net:27017' => [ServerDescription],
      'cluster0-shard-00-01.ldeju.mongodb.net:27017' => [ServerDescription]
    },
    stale: false,
    compatible: true,
    heartbeatFrequencyMS: 10000,
    localThresholdMS: 15,
    setName: 'atlas-uf78uc-shard-0',
    maxElectionId: new ObjectId('7fffffff00000000000000f3'),
    maxSetVersion: 265,
    commonWireVersion: 0,
    logicalSessionTimeoutMinutes: 30
  },
  code: undefined,
  [cause]: MongoNetworkTimeoutError: Socket 'secureConnect' timed out after 30122ms (connectTimeoutMS: 30000)
      at TLSSocket.<anonymous> (/Users/mokanichokani/Documents/mcCode/Kimaaka/Kimaaka-extension/ISEkimaaka/server/node_modules/mongodb/lib/cmap/connect.js:288:20)
      at Object.onceWrapper (node:events:621:28)
      at TLSSocket.emit (node:events:507:28)
      at Socket._onTimeout (node:net:604:8)
      at listOnTimeout (node:internal/timers:608:17)
      at process.processTimers (node:internal/timers:543:7) {
    errorLabelSet: Set(2) { 'ResetPool', 'InterruptInUseConnections' },
    beforeHandshake: false,
    [cause]: undefined
  }
}
[2025-08-10T17:35:35.458Z] Response: 503 GET /api/health
[2025-08-10T17:35:35.458Z] Error Response: {"status":"unhealthy","database":"error","error":"Socket 'secureConnect' timed out after 30122ms (connectTimeoutMS: 30000)","timestamp":"2025-08-10T17:36:05.464Z"}
[2025-08-10T17:36:05.724Z] üîó Mongoose connected to MongoDB
[2025-08-10T17:36:39.107Z] ‚ö†Ô∏è Mongoose disconnected from MongoDB
[2025-08-10T17:36:46.822Z] üîó Mongoose connected to MongoDB
üìä Resumed usage tracking for server: http://localhost:3001/api
üìä Resumed usage tracking for server: http://localhost:3001/api
[2025-08-10T17:35:43.457Z] Response: 503 GET /api/health
[2025-08-10T17:35:43.457Z] Error Response: {"status":"unhealthy","database":"disconnected","timestamp":"2025-08-10T17:36:47.137Z"}
[2025-08-10T17:35:39.454Z] Response: 503 GET /api/health
[2025-08-10T17:35:39.454Z] Error Response: {"status":"unhealthy","database":"disconnected","timestamp":"2025-08-10T17:36:47.163Z"}
[2025-08-10T18:13:40.535Z] GET /api/health - IP: ::1
[2025-08-10T18:13:40.535Z] Response: 200 GET /api/health
[2025-08-10T18:13:46.149Z] GET /api/health - IP: ::1
[2025-08-10T18:13:46.149Z] Response: 200 GET /api/health
[2025-08-10T18:14:16.505Z] GET /api/health - IP: ::1
[2025-08-10T18:14:16.505Z] Response: 200 GET /api/health
[2025-08-10T18:14:46.516Z] GET /api/health - IP: ::1
[2025-08-10T18:14:46.516Z] Response: 200 GET /api/health
[2025-08-10T18:15:16.516Z] GET /api/health - IP: ::1
[2025-08-10T18:15:16.516Z] Response: 200 GET /api/health
[2025-08-10T18:15:46.520Z] GET /api/health - IP: ::1
[2025-08-10T18:15:46.520Z] Response: 200 GET /api/health
[2025-08-10T18:16:16.521Z] GET /api/health - IP: ::1
[2025-08-10T18:16:16.521Z] Response: 200 GET /api/health
[2025-08-10T18:16:21.345Z] GET /api/health - IP: ::1
[2025-08-10T18:16:21.345Z] Response: 200 GET /api/health
[2025-08-10T18:16:33.410Z] GET /api/health - IP: ::1
[2025-08-10T18:16:33.410Z] Response: 200 GET /api/health
[2025-08-10T18:16:46.518Z] GET /api/health - IP: ::1
[2025-08-10T18:16:46.518Z] Response: 200 GET /api/health
[2025-08-10T18:17:16.648Z] GET /api/health - IP: ::1
[2025-08-10T18:17:16.648Z] Response: 200 GET /api/health
[2025-08-10T18:17:48.511Z] GET /api/health - IP: ::1
[2025-08-10T18:17:48.511Z] Response: 200 GET /api/health
[2025-08-10T18:18:48.553Z] GET /api/health - IP: ::1
[2025-08-10T18:18:48.553Z] Response: 200 GET /api/health
[2025-08-10T18:19:48.519Z] GET /api/health - IP: ::1
[2025-08-10T18:19:48.519Z] Response: 200 GET /api/health
[2025-08-10T18:20:48.537Z] GET /api/health - IP: ::1
[2025-08-10T18:20:48.537Z] Response: 200 GET /api/health
[2025-08-10T18:21:48.534Z] GET /api/health - IP: ::1
[2025-08-10T18:21:48.534Z] Response: 200 GET /api/health
[2025-08-10T18:22:48.517Z] GET /api/health - IP: ::1
[2025-08-10T18:22:48.517Z] Response: 200 GET /api/health
[2025-08-10T18:23:48.535Z] GET /api/health - IP: ::1
[2025-08-10T18:23:48.535Z] Response: 200 GET /api/health
[2025-08-10T18:24:48.532Z] GET /api/health - IP: ::1
[2025-08-10T18:24:48.532Z] Response: 200 GET /api/health
[2025-08-10T18:25:48.534Z] GET /api/health - IP: ::1
[2025-08-10T18:25:48.534Z] Response: 200 GET /api/health
[2025-08-10T18:26:48.532Z] GET /api/health - IP: ::1
[2025-08-10T18:26:48.532Z] Response: 200 GET /api/health
[2025-08-10T18:27:48.537Z] GET /api/health - IP: ::1
[2025-08-10T18:27:48.537Z] Response: 200 GET /api/health
